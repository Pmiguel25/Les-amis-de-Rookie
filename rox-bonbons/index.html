<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Activit√© Rox - Bonbons</title>

  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: Arial, sans-serif;
    }

    #container {
      display: flex;
      height: 100vh;
    }

    /* ----------------------------
       ZONE GAUCHE (Rox)
    ---------------------------- */
    #leftPanel {
      width: 25%;
      padding: 20px;
      box-sizing: border-box;
      text-align: center;
      border-right: 2px solid white;
    }

    #roxImg {
      max-width: 100%;
      max-height: 60vh;
    }

    #score {
      margin-top: 20px;
      font-size: 18px;
      white-space: pre-line;
    }

    /* ----------------------------
       ZONE DROITE (Cercles)
       => placement en bas prioritaire
    ---------------------------- */
    #gameArea {
      width: 75%;
      padding: 30px;
      box-sizing: border-box;

      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 50px;

      justify-items: center;

      /* ‚≠ê priorit√© bas */
      align-content: end;
    }

    /* ----------------------------
       CASE DE JEU
       cercle + image superpos√©s
    ---------------------------- */
    .circleBox {
      position: relative;
      width: 100px;
      height: 100px;
    }

    /* Cercle bleu */
    .circle {
      position: absolute;
      inset: 0;

      border-radius: 50%;
      background: deepskyblue;
      cursor: pointer;

      /* cercle toujours au-dessus */
      z-index: 2;

      /* ‚≠ê transition douce */
      transition: opacity 0.2s;
    }

    /* ‚≠ê Cache le cercle sans cacher l‚Äôimage */
    .hidden {
      opacity: 0;
      pointer-events: none;
    }

    /* Image bonbon/emballage */
    .rewardImg {
      position: absolute;

      /* centrage parfait */
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);

      width: 70px;
      height: 70px;

      display: none;

      /* ‚≠ê ratio respect√© */
      object-fit: contain;

      /* toujours sous le cercle */
      z-index: 1;
    }

    /* ----------------------------
       MESSAGE DE FIN
    ---------------------------- */
    #successMessage {
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      padding: 30px;
      border-radius: 20px;
      text-align: center;
      display: none;
      z-index: 10;
    }

    button {
      margin-top: 15px;
      padding: 12px 20px;
      font-size: 18px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div id="container">

  <!-- Zone gauche -->
  <div id="leftPanel">
    <h2>Rox</h2>
    <img id="roxImg" src="images/rox2.png">
    <div id="score"></div>
  </div>

  <!-- Zone droite -->
  <div id="gameArea"></div>

</div>

<!-- Message de r√©ussite -->
<div id="successMessage">
  <h2>üéâ Bravo ! Tous les bonbons sont trouv√©s !</h2>
  <button onclick="nextLevel()">Niveau suivant</button>
</div>

<script>
/* ===============================
   IMAGES
================================ */

const RoxImages = [
  "images/rox1.png",
  "images/rox2.png",
  "images/rox3.png",
  "images/rox4.png",
  "images/rox5.png"
];

const bonbonImage = "images/bonbon_entier.png";
const emballageImage = "images/emballage_vide.png";

/* ===============================
   VARIABLES
================================ */

let happiness = 1; // commence niveau 2
let totalCircles = 2;
let found = 0;
let wins = 0;

/* ===============================
   ROX
================================ */

function updateRox() {
  document.getElementById("roxImg").src = RoxImages[happiness];
}

/* ===============================
   SCORE
================================ */

function updateScore() {
  document.getElementById("score").innerText =
    `Bonbons trouv√©s : ${found} / ${totalCircles}\nParties gagn√©es : ${wins}`;
}

/* ===============================
   CONSTRUCTION DES CERCLES
================================ */

function buildCircles() {
  const area = document.getElementById("gameArea");
  area.innerHTML = "";
  found = 0;

  for (let i = 0; i < totalCircles; i++) {

    const box = document.createElement("div");
    box.className = "circleBox";

    const reward = document.createElement("img");
    reward.className = "rewardImg";

    const circle = document.createElement("div");
    circle.className = "circle";
    circle.dataset.clicked = "0";

    circle.onclick = () => handleClick(circle, reward);

    box.appendChild(reward);
    box.appendChild(circle);

    area.appendChild(box);
  }

  updateScore();
}

/* ===============================
   CLIC SUR CERCLE
================================ */

function handleClick(circle, rewardImg) {

  /* Affiche toujours l‚Äôimage */
  rewardImg.style.display = "block";
  rewardImg.style.opacity = "1";

  /* Cache seulement le cercle */
  circle.classList.add("hidden");

  if (circle.dataset.clicked === "0") {

    // Premier clic => bonbon
    circle.dataset.clicked = "1";
    rewardImg.src = bonbonImage;

    found++;

    // Rox revient niveau 1
    happiness = 0;

  } else {

    // D√©j√† cliqu√© => emballage vide
    rewardImg.src = emballageImage;

    // Rox descend
    if (happiness < 4) happiness++;
  }

  updateRox();
  updateScore();

  /* R√©apparition cercle apr√®s 3 secondes */
  setTimeout(() => {
    circle.classList.remove("hidden");
  }, 3000);

  /* Partie gagn√©e */
  if (found === totalCircles) {
    wins++;
    document.getElementById("successMessage").style.display = "block";
  }
}

/* ===============================
   NIVEAU SUIVANT
================================ */

function nextLevel() {
  document.getElementById("successMessage").style.display = "none";

  totalCircles++;
  happiness = 1;

  buildCircles();
  updateRox();
}

/* ===============================
   D√âMARRAGE
================================ */

updateRox();
buildCircles();
</script>

</body>
</html>


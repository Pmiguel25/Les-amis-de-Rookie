<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu de Formes</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f5;
            position: relative;
            overflow: hidden;
        }

        .zone {
            position: absolute;
            width: 300px;
            height: 300px;
            border: 10px solid black;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .zone.cercle {
            border-radius: 50%;
            top: 20px;
            left: 20px;
        }

        .zone.carre {
            top: 20px;
            right: 20px;
        }

        .zone.triangle {
            bottom: 20px;
            left: 20px;
            background: none;
        }

        .zone.triangle svg {
            width: 300px;
            height: 300px;
        }

        .forme {
            position: absolute;
            width: 100px;
            height: 100px;
            background-color: blue;
            cursor: pointer;
        }

        .forme.cercle {
            border-radius: 50%;
        }

        .forme.triangle {
            width: 0;
            height: 0;
            border-left: 50px solid transparent;
            border-right: 50px solid transparent;
            border-bottom: 100px solid blue;
        }

        .forme.carre {
            /* no special styles needed */
        }

        .forme.triangle svg {
            width: 100px;
            height: 100px;
        }

        #message {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border: 2px solid black;
            border-radius: 10px;
            text-align: center;
            z-index: 10;
        }

        #rejouer {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="zone cercle" data-type="cercle"></div>
    <div class="zone carre" data-type="carre"></div>
    <div class="zone triangle" data-type="triangle">
        <svg viewBox="0 0 100 100">
            <polygon points="50,0 100,100 0,100" fill="white" stroke="black" stroke-width="5"></polygon>
        </svg>
    </div>

    <div id="message">
        <p>Félicitations, vous avez réussi !</p>
        <button id="rejouer">Rejouer</button>
    </div>

    <script>
        const formes = [
            ...Array(5).fill('cercle'),
            ...Array(5).fill('carre'),
            ...Array(5).fill('triangle')
        ];
        let placed = 0;

        const zones = document.querySelectorAll('.zone');
        const message = document.getElementById('message');
        const rejouerBtn = document.getElementById('rejouer');

        formes.forEach((type, index) => {
            const forme = document.createElement('div');
            forme.classList.add('forme', type);
            forme.setAttribute('draggable', 'true');
            forme.style.top = `${Math.random() * 80 + 10}vh`;
            forme.style.left = `${Math.random() * 80 + 10}vw`;
            forme.dataset.type = type;

            document.body.appendChild(forme);

            forme.addEventListener('touchstart', (e) => {
                e.target.dataset.dragging = true;
                e.target.dataset.offsetX = e.touches[0].clientX - e.target.getBoundingClientRect().left;
                e.target.dataset.offsetY = e.touches[0].clientY - e.target.getBoundingClientRect().top;
            });

            forme.addEventListener('touchmove', (e) => {
                if (e.target.dataset.dragging) {
                    e.target.style.left = `${e.touches[0].clientX - e.target.dataset.offsetX}px`;
                    e.target.style.top = `${e.touches[0].clientY - e.target.dataset.offsetY}px`;
                }
            });

            forme.addEventListener('touchend', (e) => {
                e.target.dataset.dragging = false;
                handleDrop(e.target, e.changedTouches[0].clientX, e.changedTouches[0].clientY);
            });

            forme.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', e.target.dataset.type);
                forme.dataset.dragging = true;
            });

            forme.addEventListener('dragend', (e) => {
                forme.dataset.dragging = false;
            });
        });

        zones.forEach((zone) => {
            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            zone.addEventListener('drop', (e) => {
                const type = e.dataTransfer.getData('text/plain');
                const dragged = document.querySelector(`.forme[data-type="${type}"][data-dragging="true"]`);
                handleDrop(dragged, e.clientX, e.clientY, zone);
            });
        });

        function handleDrop(dragged, x, y, zone = null) {
            const rect = zone ? zone.getBoundingClientRect() : null;

            if (zone && rect && x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom && zone.dataset.type === dragged.dataset.type) {
                dragged.style.backgroundColor = 'green';
                dragged.setAttribute('draggable', 'false');
                dragged.style.position = 'absolute';
                dragged.style.left = `${x - rect.left - dragged.offsetWidth / 2}px`;
                dragged.style.top = `${y - rect.top - dragged.offsetHeight / 2}px`;
                zone.appendChild(dragged);
                placed++;

                if (placed === formes.length) {
                    message.style.display = 'block';
                }
            } else {
                dragged.style.backgroundColor = 'red';
                setTimeout(() => {
                    dragged.style.backgroundColor = 'blue';
                }, 2000);
            }
        }

        rejouerBtn.addEventListener('click', () => {
            location.reload();
        });
    </script>
</body>
</html>

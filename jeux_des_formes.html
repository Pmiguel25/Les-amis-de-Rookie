<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu des Formes</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: black;
            color: white;
        }

        #game-area {
            position: relative;
            width: 800px;
            height: 800px;
            border: 2px solid #000;
            background-color: #fff;
        }

        .shape {
            width: 50px;
            height: 50px;
            position: absolute;
            cursor: grab;
        }

        .circle {
            border-radius: 50%;
            background-color: blue;
        }

        .square {
            background-color: blue;
        }

        .triangle {
            width: 0;
            height: 0;
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-bottom: 50px solid blue;
        }

        .dropzone {
            position: absolute;
            border: 4px solid #333;
            background-color: white;
        }

        #circle-zone {
            top: 50px;
            left: 50px;
            width: 200px;
            height: 200px;
            border-radius: 50%;
        }

        #square-zone {
            top: 50px;
            right: 50px;
            width: 200px;
            height: 200px;
        }

        #triangle-zone {
            bottom: 50px;
            left: 300px;
            width: 0;
            height: 0;
            border-left: 100px solid transparent;
            border-right: 100px solid transparent;
            border-bottom: 200px solid #333;
        }
    </style>
</head>
<body>
    <h1>Jeu des Formes</h1>
    <div id="game-area">
        <div id="circle-zone" class="dropzone"></div>
        <div id="square-zone" class="dropzone"></div>
        <div id="triangle-zone" class="dropzone"></div>

        <script>
            const gameArea = document.getElementById("game-area");
            const dropzones = document.querySelectorAll('.dropzone');
            let correctCount = 0;

            // Vérifie si une position donnée est dans une zone cible
            function isInDropzone(x, y, dropzones) {
                return Array.from(dropzones).some(zone => {
                    const zoneRect = zone.getBoundingClientRect();
                    const gameAreaRect = gameArea.getBoundingClientRect();
                    const adjustedZoneRect = {
                        top: zoneRect.top - gameAreaRect.top,
                        left: zoneRect.left - gameAreaRect.left,
                        right: zoneRect.right - gameAreaRect.left,
                        bottom: zoneRect.bottom - gameAreaRect.top
                    };

                    return (
                        x >= adjustedZoneRect.left &&
                        x <= adjustedZoneRect.right &&
                        y >= adjustedZoneRect.top &&
                        y <= adjustedZoneRect.bottom
                    );
                });
            }

            // Crée les formes et vérifie qu'elles n'apparaissent pas dans les zones cibles
            function createShapes() {
                for (let i = 0; i < 5; i++) {
                    ['circle', 'square', 'triangle'].forEach(shapeType => {
                        let x, y;

                        do {
                            x = Math.random() * (gameArea.clientWidth - 50);
                            y = Math.random() * (gameArea.clientHeight - 50);
                        } while (isInDropzone(x, y, dropzones));

                        const shape = document.createElement('div');
                        shape.className = `shape ${shapeType}`;
                        shape.style.left = `${x}px`;
                        shape.style.top = `${y}px`;
                        gameArea.appendChild(shape);

                        // Ajout des événements de déplacement
                        shape.addEventListener('mousedown', startDrag);
                        shape.addEventListener('touchstart', startDragTouch, { passive: false });
                    });
                }
            }

            // Gestion du drag (souris)
            function startDrag(event) {
                const shape = event.target;
                let initialX = event.clientX;
                let initialY = event.clientY;
                let shapeX = parseInt(shape.style.left, 10);
                let shapeY = parseInt(shape.style.top, 10);

                function onMouseMove(e) {
                    const deltaX = e.clientX - initialX;
                    const deltaY = e.clientY - initialY;

                    const newX = shapeX + deltaX;
                    const newY = shapeY + deltaY;

                    // Empêcher les formes de sortir de la zone de jeu
                    shape.style.left = `${Math.max(0, Math.min(newX, gameArea.clientWidth - 50))}px`;
                    shape.style.top = `${Math.max(0, Math.min(newY, gameArea.clientHeight - 50))}px`;
                }

                function onMouseUp() {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                    checkDrop(shape);
                }

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            }

            // Gestion du drag (tactile)
            function startDragTouch(event) {
                event.preventDefault();
                const shape = event.target;
                let initialX = event.touches[0].clientX;
                let initialY = event.touches[0].clientY;
                let shapeX = parseInt(shape.style.left, 10);
                let shapeY = parseInt(shape.style.top, 10);

                function onTouchMove(e) {
                    const deltaX = e.touches[0].clientX - initialX;
                    const deltaY = e.touches[0].clientY - initialY;

                    const newX = shapeX + deltaX;
                    const newY = shapeY + deltaY;

                    // Empêcher les formes de sortir de la zone de jeu
                    shape.style.left = `${Math.max(0, Math.min(newX, gameArea.clientWidth - 50))}px`;
                    shape.style.top = `${Math.max(0, Math.min(newY, gameArea.clientHeight - 50))}px`;
                }

                function onTouchEnd() {
                    document.removeEventListener('touchmove', onTouchMove);
                    document.removeEventListener('touchend', onTouchEnd);
                    checkDrop(shape);
                }

                document.addEventListener('touchmove', onTouchMove);
                document.addEventListener('touchend', onTouchEnd);
            }

            // Vérifie si une forme est bien déposée dans une zone cible
            function checkDrop(shape) {
                dropzones.forEach(zone => {
                    const zoneRect = zone.getBoundingClientRect();
                    const shapeRect = shape.getBoundingClientRect();

                    if (
                        shapeRect.left >= zoneRect.left &&
                        shapeRect.right <= zoneRect.right &&
                        shapeRect.top >= zoneRect.top &&
                        shapeRect.bottom <= zoneRect.bottom
                    ) {
                        if (
                            (zone.id === 'circle-zone' && shape.classList.contains('circle')) ||
                            (zone.id === 'square-zone' && shape.classList.contains('square')) ||
                            (zone.id === 'triangle-zone' && shape.classList.contains('triangle'))
                        ) {
                            if (shape.classList.contains('triangle')) {
                                shape.style.borderBottomColor = 'green';
                            } else {
                                shape.style.backgroundColor = 'green';
                            }

                            shape.style.pointerEvents = 'none';
                            correctCount++;

                            if (correctCount === 15) {
                                setTimeout(() => alert('Bravo ! Vous avez terminé !'), 100);
                            }
                        }
                    }
                });
            }

            // Initialisation du jeu
            createShapes();
        </script>
    </div>
</body>
</html>

